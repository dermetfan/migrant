# migrant_lib

[![Build Status](https://travis-ci.org/jaemk/migrant.svg?branch=master)](https://travis-ci.org/jaemk/migrant)
[![crates.io:migrant_lib](https://img.shields.io/crates/v/migrant_lib.svg?label=migrant_lib)](https://crates.io/crates/migrant_lib)
[![docs](https://docs.rs/migrant_lib/badge.svg)](https://docs.rs/migrant_lib)

> Embeddable migration management

`migrant_lib` allows defining and embedding management of migration in your shipped app.


```rust
fn up(_: DbConn) -> Result<(), Box<std::error::Error>> {
    print!(" Up!");
    Ok(())
}

fn down(_: DbConn) -> Result<(), Box<std::error::Error>> {
    print!(" Down!");
    Ok(())
}

config.use_migrations(vec![
    FileMigration::with_tag("initial")?
        .up("migrations/initial/up.sql")?
        .down("migrations/initial/down.sql")?
        .boxed(),
    EmbeddedFileMigration::with_tag("second")?
        .up(include_str!("../migrations/second/up.sql"))?
        .down(include_str!("../migrations/second/down.sql"))?
        .boxed(),
    FnMigration::with_tag("custom")?
        .up(up)
        .down(down)
        .boxed(),
])?;
```


Migrations can be defined as files or functions. Migrations can be either read from
files at runtime or embedded in your executable at compile time.
Migration tags must all be unique. Function migrations must have the signature
`fn(DbConn) -> Result<(), Box<std::error::Error>>`. See the
[embedded/programmable example](https://github.com/jaemk/migrant/blob/master/migrant_lib/examples/embedded_programmable.rs)
for a working sample. When working with migrations, the respective database feature must
be enabled (`postgresql` / `sqlite`). The entirety of the database-specific connection library will
be re-exported in the `types` module.

Migrations management identical to the [`migrant`](https://github.com/jaemk/migrant) cli tool can also be embedded.
This method only supports file-base migrations generated by `migrant_lib` (or `migrant` cli). See the
[migrant-cli-compatible example](https://github.com/jaemk/migrant/blob/master/migrant_lib/examples/migrant_cli_compatible.rs)
for a working sample.


License: MIT
